library(knitr)
library(kableExtra)
library(plot3D)
x<-Oventralis_2011$Encounter_rate_with_floating_male
y<-Oventralis_2011$condensation_of_the_bower
z<-Oventralis_2011$Sperm_longevity
library(rgl)
plot3d(x=Oventralis_2011$Encounter_rate_with_floating_male, y=Oventralis_2011$condensation_of_the_bower, z=Oventralis_2011$Sperm_longevity)
library(scatterplot3d)
scatterplot3d(x=Oventralis_2011$Encounter_rate_with_floating_male, y=Oventralis_2011$condensation_of_the_bower, z=Oventralis_2011$Sperm_longevity)

# create the fitted points for droplines to the surface
          fitpoints <- predict(fit)
          
          # scatter plot with regression plane
          scatter3D(x, y, z, pch = 19, cex = 1,colvar = NULL, col="red", 
                    theta = 20, phi = 10, bty="b",
                    xlab = "ECRS", ylab = "DS", zlab = "SPP120 expressions",  
                    surf = list(x = x.pred, y = y.pred, z = z.pred,  
                                facets = TRUE, fit = fitpoints, col=ramp.col (col = c("dodgerblue3","seagreen2"), n = 300, alpha=0.9), border="black"), main = "SPP120 expression")    
          ###
          x<-Oventralis_2011$Success_rate_of_lekking
          y<-Oventralis_2011$condensation_of_the_bower
          z<-log(Oventralis_2011$rSPP120_1)
          
          fit <- lm(z ~ x + y)
          # create a grid from the x and y values (min to max) and predict values for every point
          # this will become the regression plane
          grid.lines = 40
          x.pred <- seq(min(x), max(x), length.out = grid.lines)
          y.pred <- seq(min(y), max(y), length.out = grid.lines)
          xy <- expand.grid( x = x.pred, y = y.pred)
          z.pred <- matrix(predict(fit, newdata = xy), 
                           nrow = grid.lines, ncol = grid.lines)
          
          # create the fitted points for droplines to the surface
          fitpoints <- predict(fit)
          
          # scatter plot with regression plane
          scatter3D(x, y, z, pch = 19, cex = 1,colvar = NULL, col="red", 
                    theta = 20, phi = 10, bty="b",
                    xlab = "CSR", ylab = "DS", zlab = "SPP120 expressions",  
                    surf = list(x = x.pred, y = y.pred, z = z.pred,  
                                facets = TRUE, fit = fitpoints, col=ramp.col (col = c("dodgerblue3","seagreen2"), n = 300, alpha=0.9), border="black"), main = "SPP120 expression")    
          
          
          ###
          x<-Oventralis_2011$Success_rate_of_lekking*Oventralis_2011$Encounter_rate_with_floating_male
          y<-Oventralis_2011$condensation_of_the_bower*Oventralis_2011$Success_rate_of_lekking
          z<-log(Oventralis_2011$rSPP120_1)
          
          fit <- lm(z ~ x + y)
          # create a grid from the x and y values (min to max) and predict values for every point
          # this will become the regression plane
          grid.lines = 40
          x.pred <- seq(min(x), max(x), length.out = grid.lines)
          y.pred <- seq(min(y), max(y), length.out = grid.lines)
          xy <- expand.grid( x = x.pred, y = y.pred)
          z.pred <- matrix(predict(fit, newdata = xy), 
                           nrow = grid.lines, ncol = grid.lines)
          
          # create the fitted points for droplines to the surface
          fitpoints <- predict(fit)
          
          # scatter plot with regression plane
          scatter3D(x, y, z, pch = 19, cex = 1,colvar = NULL, col="red", 
                    theta = 20, phi = 10, bty="b",
                    xlab = "CSR:ERFM", ylab = "CSR:DS", zlab = "SPP120 expressions",  
                    surf = list(x = x.pred, y = y.pred, z = z.pred,  
                                facets = TRUE, fit = fitpoints, col=ramp.col (col = c("dodgerblue3","seagreen2"), n = 300, alpha=0.9), border="black"), main = "SPP120 expression")    
          #
          library(lattice)
          require(rms)

          require(lattice)
          lininterp <- ols(z ~ x+y)
          bplot(Predict(lininterp, x=25:40, y=45:60), 
                lfun=wireframe,  # bplot passes extra arguments to wireframe
                screen = list(z = -10, x = -50), drape=TRUE)
          
          ##
          x<-Oventralis_2011$condensation_of_the_bower
          y<-Oventralis_2011$Sperm_longevity
          z<-Oventralis_2011$Swimming_velocity
          
          # Compute the linear regression 
          fit <- lm(z ~ x + y)
          # create a grid from the x and y values (min to max) and predict values for every point
          # this will become the regression plane
          grid.lines = 40
          x.pred <- seq(min(x), max(x), length.out = grid.lines)
          y.pred <- seq(min(y), max(y), length.out = grid.lines)
          xy <- expand.grid( x = x.pred, y = y.pred)
          z.pred <- matrix(predict(fit, newdata = xy), 
                           nrow = grid.lines, ncol = grid.lines)
          
          # create the fitted points for droplines to the surface
          fitpoints <- predict(fit)
          
          # scatter plot with regression plane
          scatter3D(x, y, z, pch = 19, cex = 1,colvar = NULL, col="red", 
                    theta = 20, phi = 10, bty="b",
                    xlab = "DS", ylab = "Sperm longevity", zlab = "Swimming speed",  
                    surf = list(x = x.pred, y = y.pred, z = z.pred,  
                                facets = TRUE, fit = fitpoints, col=ramp.col (col = c("dodgerblue3","seagreen2"), n = 300, alpha=0.9), border="black"), main = "Sperm swimming velovity")    
          
          #GSI
          x<-Oventralis_2011$Success_rate_of_lekking
          y<-Oventralis_2011$Encounter_rate_with_floating_male*Oventralis_2011$condensation_of_the_bower
          z<-Oventralis_2011$GSI
          
          # Compute the linear regression 
          fit <- lm(z ~ x + y)
          
          # create a grid from the x and y values (min to max) and predict values for every point
          # this will become the regression plane
          grid.lines = 40
          x.pred <- seq(min(x), max(x), length.out = grid.lines)
          y.pred <- seq(min(y), max(y), length.out = grid.lines)
          xy <- expand.grid( x = x.pred, y = y.pred)
          z.pred <- matrix(predict(fit, newdata = xy), 
                           nrow = grid.lines, ncol = grid.lines)
          
          # create the fitted points for droplines to the surface
          fitpoints <- predict(fit)
          
          # scatter plot with regression plane
          scatter3D(x, y, z, pch = 19, cex = 1,colvar = NULL, col="red", 
                    theta = 20, phi = 10, bty="b",
                    xlab = "CSR", ylab = "ERFM*DS", zlab = "GSI",  
                    surf = list(x = x.pred, y = y.pred, z = z.pred,  
                                facets = TRUE, fit = fitpoints, col=ramp.col (col = c("dodgerblue3","seagreen2"), n = 300, alpha=0.9), border="black"), main = "GSI")    
          
        
