library(knitr)
library(kableExtra)
library(plot3D)
library(xlsx)
OvData3<-read.xlsx("~/R_data/Supplemenatry_data_data_set_for_analyses_3_5.xlsx","Sheet1")

##Plot SPP120_CSR:ERFM_Risk_SPC:CSR:ERFM
x<-OvData3$CSR*OvData3$ERFM
y<-OvData3$CSR*OvData3$ERFM*OvData3$FS_Risk
z<-OvData3$Log_RelativeSPP_1
# scatter plot with regression plane
scatter3D(x, y, z, pch = 19, cex = 1,colvar = NULL, col="red", 
          theta = 20, phi = 10, bty="b",
          xlab = "CSR*ERFM", ylab = "CSR*ERFM*FS_Risk", zlab = "SPP120 expressions",  
          surf = list(x = x.pred, y = y.pred, z = z.pred,  
                      facets = TRUE, fit = fitpoints, col=ramp.col (col = c("dodgerblue3","seagreen2"), n = 300, alpha=0.9), border="black"), main = "SPP120 expression")    
###Plot longevity
x<-OvData3$CSR*OvData3$ERFM
y<-OvData3$CSR*OvData3$ERFM*OvData3$FS_Risk
z<-OvData3$Sperm_longevity

fit <- lm(z ~ x + y)
# create a grid from the x and y values (min to max) and predict values for every point
# this will become the regression plane
grid.lines = 40
x.pred <- seq(min(x), max(x), length.out = grid.lines)
y.pred <- seq(min(y), max(y), length.out = grid.lines)
xy <- expand.grid( x = x.pred, y = y.pred)
z.pred <- matrix(predict(fit, newdata = xy), 
                 nrow = grid.lines, ncol = grid.lines)

# create the fitted points for droplines to the surface
fitpoints <- predict(fit)

# scatter plot with regression plane
scatter3D(x, y, z, pch = 19, cex = 1,colvar = NULL, col="red", 
          theta = 20, phi = 10, bty="b",
          xlab = "CSR*ERFM", ylab = "CSR*ERFM*FS_Risk", zlab = "Sperm longevity",  
          surf = list(x = x.pred, y = y.pred, z = z.pred,  
                      facets = TRUE, fit = fitpoints, col=ramp.col (col = c("dodgerblue3","seagreen2"), n = 300, alpha=0.9), border="black"), main = "Sperm longevity")    
###Plot GSI
x<-OvData3$CSR
y<-OvData3$FS_Risk
z<-OvData3$GSI

fit <- lm(z ~ x + y)
# create a grid from the x and y values (min to max) and predict values for every point
# this will become the regression plane
grid.lines = 40
x.pred <- seq(min(x), max(x), length.out = grid.lines)
y.pred <- seq(min(y), max(y), length.out = grid.lines)
xy <- expand.grid( x = x.pred, y = y.pred)
z.pred <- matrix(predict(fit, newdata = xy), 
                 nrow = grid.lines, ncol = grid.lines)

# create the fitted points for droplines to the surface
fitpoints <- predict(fit)

# scatter plot with regression plane
scatter3D(x, y, z, pch = 19, cex = 1,colvar = NULL, col="red", 
          theta = 20, phi = 10, bty="b",
          xlab = "CSR", ylab = "FS_SPC", zlab = "GSI",  
          surf = list(x = x.pred, y = y.pred, z = z.pred,  
                      facets = TRUE, fit = fitpoints, col=ramp.col (col = c("dodgerblue3","seagreen2"), n = 300, alpha=0.9), border="black"), main = "GSI")    

